{{/*
  这是一个简化的、更健壮的 image.html 版本，用于调试。
*/}}
{{ $src := .Src }}
{{ $page := .Context }}
{{ $alt := .Alt | default $page.Title }}

{{ $image := "" }}

{{/* 检查 $src 是否被定义 */}}
{{ if $src }}
  {{/* 首先，尝试作为页面资源（与md文件在同一目录）查找 */}}
  {{ with $page.Resources.GetMatch $src }}
    {{ $image = . }}
  {{ else }}
    {{/* 如果找不到，就去 /assets 目录里查找全局资源 */}}
    {{ with resources.Get $src }}
      {{ $image = . }}
    {{ end }}
  {{ end }}
{{ end }}


{{/* 如果成功找到了图片资源 */}}
{{ if $image }}
  {{/* 从Front Matter获取尺寸，如果未提供，则使用图片的原始尺寸 */}}
  {{ $width := .Width | default $image.Width }}
  {{ $height := .Height | default $image.Height }}

  {{/* 检查尺寸是否有效，防止Resize出错 */}}
  {{ if or (not (gt $width 0)) (not (gt $height 0)) }}
    {{ errorf "Image partial: Invalid width or height for image '%s' on page '%s'. Width and Height must be provided in Front Matter and be greater than 0." $src $page.File.Path }}
  {{ end }}

  {{/* 调整图片尺寸 */}}
  {{ $resized := $image.Resize (printf "%dx%d" $width $height) }}

  <img
    class="{{ .Class }}"
    src="{{ $resized.RelPermalink }}"
    width="{{ $resized.Width }}"
    height="{{ $resized.Height }}"
    alt="{{ $alt }}"
    loading="lazy" />

{{ else if $src }}
  {{/* 如果提供了src但找不到图片，就报错 */}}
  {{ errorf "Image partial: Image '%s' not found for page '%s'. Make sure it exists in /assets/%s or alongside the content file." $src $page.File.Path $src }}
{{ end }}
